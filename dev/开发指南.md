# MPCé’±åŒ…å¼€å‘å®¹å™¨ç®¡ç†æŒ‡å—

## ğŸš€ ä¼˜åŒ–åçš„å¼€å‘æµç¨‹

### ç›®æ ‡
- **æµ‹è¯•æ—¶é—´**ï¼šä»3-5åˆ†é’Ÿç¼©çŸ­åˆ°30ç§’ä»¥å†…
- **ç½‘ç»œä¾èµ–**ï¼šä»æ¯æ¬¡æµ‹è¯•åˆ°ä»…é¦–æ¬¡å¯åŠ¨
- **å¼€å‘æ•ˆç‡**ï¼šæé«˜10-30å€

### æ—¥å¸¸æ“ä½œæµç¨‹

```bash
# æ—©ä¸Šå¼€å§‹å·¥ä½œ
./dev/start-test-containers.sh

# å…¨å¤©å¼€å‘ï¼ˆå¤šæ¬¡æµ‹è¯•ï¼‰
./scripts/run-tests.sh

# æ£€æŸ¥çŠ¶æ€ï¼ˆéšæ—¶ï¼‰
./dev/status-test-containers.sh

# æ™šä¸Šç»“æŸå·¥ä½œ
./dev/stop-test-containers.sh
```

## ğŸ“‹ ç®¡ç†è„šæœ¬è¯´æ˜

### 1. å¯åŠ¨å®¹å™¨è„šæœ¬ (`start-test-containers.sh`)
```bash
./dev/start-test-containers.sh
```
**åŠŸèƒ½**ï¼š
- æ™ºèƒ½é€‰æ‹©é…ç½®ï¼ˆä¼˜å…ˆä½¿ç”¨ç°æœ‰é•œåƒï¼‰
- åå°æ¨¡å¼å¯åŠ¨
- è‡ªåŠ¨ç­‰å¾…æœåŠ¡å°±ç»ª
- æ˜¾ç¤ºå®¹å™¨çŠ¶æ€

**æ•ˆæœ**ï¼šé¦–æ¬¡å¯åŠ¨30ç§’ï¼Œåç»­å¯åŠ¨10ç§’

### 2. åœæ­¢å®¹å™¨è„šæœ¬ (`stop-test-containers.sh`)
```bash
./dev/stop-test-containers.sh
```
**åŠŸèƒ½**ï¼š
- åœæ­¢å®¹å™¨ä½†ä¸åˆ é™¤æ•°æ®
- ä¿æŒæ•°æ®æŒä¹…åŒ–
- ä¸‹æ¬¡å¯åŠ¨å¿«é€Ÿæ¢å¤

### 3. é‡ç½®å®¹å™¨è„šæœ¬ (`reset-test-containers.sh`)
```bash
./dev/reset-test-containers.sh
```
**åŠŸèƒ½**ï¼š
- æ¸…ç†æ‰€æœ‰æµ‹è¯•æ•°æ®
- é‡ç½®åˆ°åˆå§‹çŠ¶æ€
- éœ€è¦ç¡®è®¤æ“ä½œï¼ˆé˜²æ­¢è¯¯åˆ ï¼‰

### 4. çŠ¶æ€æ£€æŸ¥è„šæœ¬ (`status-test-containers.sh`)
```bash
./dev/status-test-containers.sh
```
**åŠŸèƒ½**ï¼š
- æ˜¾ç¤ºå®¹å™¨è¿è¡ŒçŠ¶æ€
- å¥åº·æ£€æŸ¥æ‰€æœ‰æœåŠ¡
- ç«¯å£è¿é€šæ€§éªŒè¯

## ğŸ”§ ä¼˜åŒ–åçš„æµ‹è¯•è„šæœ¬ (`run-tests.sh`)

### æ™ºèƒ½æ£€æµ‹æœºåˆ¶
1. **å®¹å™¨å¤ç”¨**ï¼šæ£€æŸ¥ç°æœ‰å®¹å™¨æ˜¯å¦è¿è¡Œ
2. **è½»é‡å¯åŠ¨**ï¼šä¼˜å…ˆå¯åŠ¨å·²æœ‰å®¹å™¨
3. **å¿«é€ŸéªŒè¯**ï¼šä»…æ£€æŸ¥å…³é”®æœåŠ¡å¥åº·

### æµ‹è¯•æµç¨‹ä¼˜åŒ–
- **è·³è¿‡æ„å»º**ï¼šå¤ç”¨ç°æœ‰é•œåƒï¼Œé¿å…é‡å¤ä¸‹è½½
- **åˆ†å±‚å¯åŠ¨**ï¼šåŸºç¡€æœåŠ¡å…ˆå¯åŠ¨ï¼Œåº”ç”¨æœåŠ¡åå¯åŠ¨
- **å¿«é€Ÿæµ‹è¯•**ï¼šä½¿ç”¨ `--quick` å‚æ•°æ‰§è¡Œæ ¸å¿ƒæµ‹è¯•

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| é¦–æ¬¡å¯åŠ¨æ—¶é—´ | 3-5åˆ†é’Ÿ | 30ç§’ | 6-10å€ |
| åç»­æµ‹è¯•æ—¶é—´ | 3-5åˆ†é’Ÿ | 10ç§’ | 18-30å€ |
| ç½‘ç»œå¤±è´¥æ¦‚ç‡ | æ¯æ¬¡æµ‹è¯• | ä»…é¦–æ¬¡ | å¤§å¹…é™ä½ |
| å¼€å‘ä½“éªŒ | ç¹çæ˜“å‡ºé”™ | æµç•…ç¨³å®š | æ˜¾è‘—æ”¹å–„ |

## ğŸ¯ æœ€ä½³å®è·µ

### å¼€å‘ä¹ æƒ¯
1. **ä¸Šåˆå¯åŠ¨**ï¼šå¼€å§‹å·¥ä½œå‰è¿è¡Œ `start-test-containers.sh`
2. **å…¨å¤©å¤ç”¨**ï¼šå¤šæ¬¡æµ‹è¯•ä½¿ç”¨ç°æœ‰å®¹å™¨
3. **æ™šä¸Šåœæ­¢**ï¼šç»“æŸå·¥ä½œè¿è¡Œ `stop-test-containers.sh`
4. **å®šæœŸé‡ç½®**ï¼šéœ€è¦å¹²å‡€ç¯å¢ƒæ—¶è¿è¡Œ `reset-test-containers.sh`

### æ•…éšœæ’æŸ¥
```bash
# æŸ¥çœ‹æ—¥å¿—
docker logs mpc-wallet-backend-api

# æ£€æŸ¥ç½‘ç»œ
docker network ls
docker network inspect mpc-wallet_default

# é‡å¯æœåŠ¡
docker compose -f docker-compose.test-minimal.yml restart backend-api
```

### æ€§èƒ½ç›‘æ§
```bash
# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯
docker inspect mpc-wallet-backend-api

# æŸ¥çœ‹æœåŠ¡å“åº”æ—¶é—´
curl -w "%{time_total}s\n" -o /dev/null -s http://localhost:3000/health
```

## ğŸ”„ é…ç½®è¯´æ˜

### ä½¿ç”¨çš„é…ç½®æ–‡ä»¶
- `docker-compose.test.yml`ï¼šå®Œæ•´æµ‹è¯•ç¯å¢ƒï¼ˆéœ€è¦æ„å»ºè‡ªå®šä¹‰é•œåƒï¼‰
- `docker-compose.test-minimal.yml`ï¼šæœ€å°åŒ–ç¯å¢ƒï¼ˆä½¿ç”¨æ ‡å‡†é•œåƒï¼‰

### æœåŠ¡ç«¯å£æ˜ å°„
- **APIæœåŠ¡**ï¼š3000
- **PostgreSQL**ï¼š5432
- **Redis**ï¼š6379
- **Ganache**ï¼š8545

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®æŒä¹…åŒ–**ï¼šåœæ­¢å®¹å™¨æ—¶æ•°æ®ä¼šä¿ç•™ï¼Œé‡ç½®æ—¶æ•°æ®ä¼šè¢«æ¸…ç†
2. **ç½‘ç»œé—®é¢˜**ï¼šé¦–æ¬¡å¯åŠ¨å¯èƒ½éœ€è¦ä¸‹è½½é•œåƒï¼Œå»ºè®®åœ¨ç½‘ç»œç¨³å®šæ—¶æ“ä½œ
3. **ç«¯å£å†²çª**ï¼šç¡®ä¿æœ¬åœ°3000ã€5432ã€6379ã€8545ç«¯å£æœªè¢«å ç”¨
4. **èµ„æºé™åˆ¶**ï¼šå¦‚æœå®¹å™¨å¯åŠ¨å¤±è´¥ï¼Œæ£€æŸ¥Dockerèµ„æºè®¾ç½®

## ğŸ†˜ å¸¸è§é—®é¢˜è§£å†³

### å®¹å™¨å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker compose -f docker-compose.test-minimal.yml logs

# é‡å¯DockeræœåŠ¡
sudo systemctl restart docker

# æ¸…ç†Dockerç¼“å­˜
docker system prune -f
```

### ç«¯å£è¢«å ç”¨
```bash
# æŸ¥çœ‹å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :3000
lsof -i :5432

# æ€æ­»å ç”¨è¿›ç¨‹
kill -9 <PID>
```

### é•œåƒæ‹‰å–å¤±è´¥
```bash
# ä½¿ç”¨å›½å†…é•œåƒæº
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://docker.mirrors.ustc.edu.cn"]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
```

## ğŸ’¡ é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰é…ç½®
ç¼–è¾‘ `docker-compose.override.yml` æ¥è‡ªå®šä¹‰æœåŠ¡é…ç½®ï¼š
```yaml
services:
  backend-api:
    environment:
      - DEBUG=true
      - LOG_LEVEL=debug
```

### æ€§èƒ½è°ƒä¼˜
```bash
# é™åˆ¶å®¹å™¨èµ„æºä½¿ç”¨
docker update --memory=512m --cpus=1 mpc-wallet-backend-api

# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats --no-stream
```

---

**å¼€å§‹äº«å—é«˜æ•ˆçš„å¼€å‘ä½“éªŒå§ï¼** ğŸš€