# MPC Web3钱包项目 - 测试联调计划

## 项目概述
基于门限签名（MPC）技术的企业级Web3钱包，专注于跨境电商区块链供应链金融平台。

## 一、当前开发完成度评估

### ✅ 已完成的模块
1. **Passkey认证流程** - 完整实现
   - WebAuthn集成和会话管理
   - 前端API接口
   - 数据库存储机制

2. **MPC核心服务** - 完整实现
   - Rust服务架构
   - 密钥管理模块
   - GG18/GG20协议实现

3. **智能合约** - 完整实现
   - 托管支付合约（EscrowPayment.sol）
   - 供应链金融合约（SupplyChainFinance.sol）

### ⚠️ 需要验证的模块
1. **区块链中间件** - 需要测试Go服务实现
2. **后端API服务** - 需要验证业务逻辑
3. **前端Web界面** - 需要测试用户交互

## 二、测试环境准备

### 2.1 基础设施启动
```bash
# 启动所有服务
make dev-up

# 验证服务状态
curl http://localhost:3000/health
curl http://localhost:8080/health
curl http://localhost:8545
```

### 2.2 数据库初始化
```bash
# 运行数据库迁移
make db-migrate

# 验证数据库连接
psql -h localhost -p 5432 -U mpc_user -d mpc_wallet
```

## 三、分阶段测试计划

### 第一阶段：核心功能单元测试（1-2天）

#### 3.1 MPC核心服务测试
```bash
cd mpc-core && cargo test
```
**测试重点：**
- 密钥生成和分片管理
- 门限签名协议执行
- 安全环境验证

#### 3.2 智能合约测试
```bash
cd smart-contracts && npx hardhat test
```
**测试重点：**
- 托管支付流程
- 供应链金融代币化
- 合约安全性验证

#### 3.3 Passkey认证测试
```bash
cd backend-services/api && go test ./internal/services/...
```
**测试重点：**
- WebAuthn注册流程
- 认证会话管理
- 用户凭证验证

### 第二阶段：服务集成测试（2-3天）

#### 3.4 后端API集成测试
```bash
cd backend-services/api && go test -v ./...
```
**测试场景：**
1. 用户注册和登录流程
2. MPC密钥管理API
3. 区块链交易接口

#### 3.5 区块链中间件测试
```bash
cd blockchain-middleware && go test -v ./...
```
**测试重点：**
- 多链RPC连接
- 交易广播和状态查询
- 事件监听机制

### 第三阶段：端到端测试（3-4天）

#### 3.6 完整业务流程测试
**测试用例：**
1. **用户注册流程**
   - Passkey生物认证
   - MPC密钥初始化
   - 钱包地址生成

2. **供应链金融流程**
   - 应收账款上链
   - 代币化融资
   - 智能合约执行

3. **跨境电商支付**
   - 托管支付发起
   - 商品交付确认
   - 资金释放流程

#### 3.7 性能和安全测试
**性能测试：**
- 并发用户处理能力
- 交易处理延迟
- 内存和CPU使用率

**安全测试：**
- MPC协议安全性验证
- 智能合约漏洞扫描
- 网络攻击防护

## 四、测试数据准备

### 4.1 测试账户
```javascript
// 测试用户数据
const testUsers = [
  {
    email: "test@supplier.com",
    company: "供应商A",
    role: "supplier"
  },
  {
    email: "test@buyer.com", 
    company: "采购商B",
    role: "buyer"
  },
  {
    email: "test@financer.com",
    company: "金融机构C", 
    role: "financer"
  }
];
```

### 4.2 测试交易数据
```solidity
// 供应链金融测试数据
struct TestInvoice {
    uint256 amount;           // 发票金额
    uint256 dueDate;         // 到期日
    address supplier;        // 供应商
    address buyer;           // 采购商
    bool isApproved;         // 是否已批准
}
```

## 五、测试工具和框架

### 5.1 自动化测试工具
- **Go测试**: 后端API和中间件测试
- **Hardhat**: 智能合约测试框架
- **Jest**: 前端React组件测试
- **Cargo测试**: Rust MPC服务测试

### 5.2 监控和日志
- **Prometheus**: 性能指标监控
- **Grafana**: 测试数据可视化
- **ELK Stack**: 日志分析

## 六、风险评估和应对

### 6.1 技术风险
- **MPC协议复杂性**: 增加测试用例覆盖度
- **区块链网络延迟**: 设置合理的超时机制
- **跨链交互**: 加强错误处理和重试逻辑

### 6.2 业务风险
- **合规性要求**: 确保符合金融监管
- **用户数据安全**: 强化加密和访问控制
- **系统可用性**: 设计高可用架构

## 七、测试验收标准

### 7.1 功能验收标准
- [ ] Passkey认证成功率 > 99%
- [ ] MPC签名成功率 > 98%
- [ ] 智能合约执行成功率 > 99%
- [ ] 端到端交易完成时间 < 30秒

### 7.2 性能验收标准
- [ ] 系统支持并发用户数 > 1000
- [ ] API响应时间 < 200ms
- [ ] 数据库查询性能 < 50ms

### 7.3 安全验收标准
- [ ] 通过安全漏洞扫描
- [ ] 数据加密符合标准
- [ ] 访问控制机制完善

## 八、测试时间安排

| 阶段 | 时间 | 负责人 | 状态 |
|------|------|--------|------|
| 环境准备 | 第1天 | 运维团队 | ⏳ |
| 单元测试 | 第1-2天 | 开发团队 | ⏳ |
| 集成测试 | 第3-5天 | 测试团队 | ⏳ |
| 端到端测试 | 第6-9天 | 全团队 | ⏳ |
| 性能测试 | 第10天 | 性能团队 | ⏳ |
| 安全测试 | 第11天 | 安全团队 | ⏳ |
| 验收测试 | 第12天 | 产品团队 | ⏳ |

## 九、后续优化建议

1. **持续集成**: 建立自动化测试流水线
2. **监控告警**: 实时监控生产环境
3. **用户反馈**: 收集真实用户使用数据
4. **性能优化**: 基于测试结果进行调优

---

**最后更新**: 2026-02-17  
**负责人**: 测试团队  
**状态**: 计划制定完成，准备执行