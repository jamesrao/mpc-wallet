# MPC钱包系统生产环境配置说明

## 🎯 配置完成状态

✅ **已完成的配置**
- Facebook应用认证配置架构
- 区块链RPC节点配置架构
- 生产环境配置文件模板

## 🔧 需要用户完成的配置

### 1. Facebook应用配置

**步骤1：创建Facebook开发者应用**
1. 访问 [Facebook开发者平台](https://developers.facebook.com/)
2. 创建新应用（选择"消费者"类型）
3. 添加"Facebook登录"产品

**步骤2：配置应用信息**
在 `.env.production` 文件中配置：
```bash
FACEBOOK_APP_ID=your_facebook_app_id_here
FACEBOOK_APP_SECRET=your_facebook_app_secret_here
FACEBOOK_REDIRECT_URI=https://yourdomain.com/api/auth/facebook/callback
```

**步骤3：配置有效的重定向URI**
在Facebook应用设置中添加：
- `https://yourdomain.com/api/auth/facebook/callback`
- `https://yourdomain.com`

### 2. 区块链RPC节点配置

**推荐的服务商：**
- **Infura** (推荐，支持多链)
- **Alchemy** (高性能)
- **QuickNode** (企业级)

**配置方法：**
在 `.env.production` 和 `blockchain-middleware/.env.production` 中配置：

```bash
# Infura配置（推荐）
ETHEREUM_RPC_URL=https://mainnet.infura.io/v3/YOUR_INFURA_PROJECT_ID
POLYGON_RPC_URL=https://polygon-mainnet.infura.io/v3/YOUR_INFURA_PROJECT_ID
ARBITRUM_RPC_URL=https://arbitrum-mainnet.infura.io/v3/YOUR_INFURA_PROJECT_ID
OPTIMISM_RPC_URL=https://optimism-mainnet.infura.io/v3/YOUR_INFURA_PROJECT_ID

# BSC配置
BSC_RPC_URL=https://bsc-dataseed.binance.org
```

### 3. 数据库配置

**生产环境推荐：**
- **PostgreSQL** (主数据库)
- **Redis** (缓存层)

**配置：**
```bash
DB_HOST=your-production-db-host
DB_USER=mpc_user
DB_PASSWORD=secure_production_password
DB_NAME=mpc_wallet
REDIS_URL=redis://your-redis-host:6379
```

## 🧪 真实用户功能测试

### 测试流程

1. **环境准备**
   ```bash
   # 应用配置
   export FACEBOOK_APP_ID=your_test_app_id
   export FACEBOOK_APP_SECRET=your_test_app_secret
   
   # 区块链配置（使用测试网）
   export ETHEREUM_RPC_URL=https://goerli.infura.io/v3/YOUR_PROJECT_ID
   export POLYGON_RPC_URL=https://polygon-mumbai.infura.io/v3/YOUR_PROJECT_ID
   ```

2. **启动服务**
   ```bash
   # 启动所有服务
   docker-compose -f docker-compose.prod.yml up -d
   ```

3. **测试用户流程**
   - Facebook登录
   - 钱包注册
   - MPC密钥生成
   - 交易签名

## 🚀 生产环境部署

### 部署选项

**选项1：Docker部署（推荐）**
```bash
# 使用生产环境配置文件
docker-compose -f docker-compose.prod.yml --env-file .env.production up -d
```

**选项2：Kubernetes部署**
```bash
# 应用Kubernetes配置
kubectl apply -f k8s/
```

**选项3：云服务部署**
- AWS ECS/EKS
- Google Cloud Run
- Azure Container Instances

### 监控和日志

**推荐工具：**
- **监控**: Prometheus + Grafana
- **日志**: ELK Stack 或 Loki
- **告警**: Alertmanager

## 🔒 安全配置

### 必须的安全措施

1. **HTTPS配置**
   ```nginx
   # Nginx配置示例
   server {
       listen 443 ssl;
       ssl_certificate /path/to/cert.pem;
       ssl_certificate_key /path/to/private.key;
   }
   ```

2. **防火墙规则**
   - 只开放必要端口（80, 443, 数据库端口）
   - 限制数据库访问IP

3. **密钥管理**
   - 使用环境变量管理敏感信息
   - 定期轮换JWT密钥

## 📊 性能优化建议

### 数据库优化
- 创建适当的索引
- 配置连接池
- 定期清理过期数据

### 缓存策略
- Redis缓存热点数据
- 实现数据预加载
- 配置合理的TTL

## 🆘 故障排除

### 常见问题

1. **Facebook认证失败**
   - 检查应用ID和密钥
   - 验证重定向URI配置
   - 确认应用状态为"上线"

2. **区块链连接失败**
   - 检查RPC URL格式
   - 验证API密钥权限
   - 确认网络连接

3. **数据库连接问题**
   - 检查连接字符串
   - 验证防火墙规则
   - 确认数据库服务状态

### 日志检查
```bash
# 查看服务日志
docker logs mpc-core
docker logs blockchain-middleware
docker logs api-service
```

## 📞 支持联系

如需技术支持，请联系：
- 技术负责人：技术支持团队
- 紧急联系：紧急响应渠道
- 文档更新：项目维护团队

---

**注意：** 在生产环境部署前，请务必备份所有数据并确保所有配置已正确测试。